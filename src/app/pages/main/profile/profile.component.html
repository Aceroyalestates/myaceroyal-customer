<!-- Profile page implemented with Tailwind CSS + NG-ZORRO components -->
<div class="p-6 bg-white min-h-screen">
	<!-- Header -->
	<div class="flex items-center justify-between mb-6">
		<div class="flex items-center gap-4">
				<!-- <button nz-button class="!border-none :hover:!bg-transparent p-2 cursor-pointer">
                    <app-icon name="arrow-left"></app-icon>
				</button> -->
				<h2 class="text-2xl font-semibold">Profile</h2>
			</div>
		<div class="text-sm text-gray-500">&nbsp;</div>
	</div>

	<!-- Top card: avatar + name + edit picture -->
	<div class="bg-white rounded-md shadow-sm p-6 mb-6">
		<div class="flex items-center justify-between">
			<div class="flex items-center gap-4">
				<div class="relative">
					<!-- <img *ngIf="user?.avatar" [src]="user?.avatar" alt="avatar" class="w-20 h-20 rounded-full object-cover" /> -->
                    @if (user?.avatar) {
                        <img [src]="user.avatar" alt="avatar" class="w-20 h-20 rounded-full object-cover" />
                    } @else {
                        <img [src]="'https://cdn.vectorstock.com/i/1000v/51/05/male-profile-avatar-with-brown-hair-vector-12055105.jpg'" alt="avatar" class="w-20 h-20 rounded-full object-cover" />
                    }
					

					<!-- uploading spinner overlay -->
					<div *ngIf="isLoading" class="absolute inset-0 bg-white/70 rounded-full flex items-center justify-center">
						<i nz-icon nzType="loading" nzSpin class="text-xl text-gray-600"></i>
					</div>
				</div>
				<div>
					<div class="text-lg font-semibold"> {{ user?.full_name }} </div>
					<div class="text-sm text-gray-500">{{ user?.email }}</div>
				</div>
			</div>
			<div class="text-right">
				<input #avatarInput type="file" accept="image/*" (change)="onAvatarFileSelected($event)" class="hidden" />
				<button nz-button nzType="link" class="!text-primary cursor-pointer" (click)="openAvatarFilePicker()">
					Upload Profile Picture
					<app-icon name="edit"></app-icon>
				</button>
			</div>
		</div>
	</div>

	<!-- Personal Information -->
	<div class="bg-white rounded-md shadow-sm p-6 mb-6">
		<div class="flex items-center justify-between mb-4">
			<h3 class="text-lg font-medium">Personal Information</h3>
			<button nz-button nzType="link" class="!text-primary cursor-pointer" (click)="openEditModal()">
				Edit Details
				<app-icon name="edit"></app-icon>
			</button>
		</div>

		<div class="grid grid-cols-1 md:grid-cols-5 gap-y-6 gap-x-6 text-sm text-gray-700">
			<div>
				<div class="text-xs text-gray-400">Full Name</div>
				<div class="mt-1">{{ user?.full_name }}</div>
			</div>
			<div>
				<div class="text-xs text-gray-400">Email</div>
				<div class="mt-1">{{ user?.email }}</div>
			</div>
			<div>
				<div class="text-xs text-gray-400">Phone Number</div>
				<div class="mt-1">{{ user?.phone_number }}</div>
			</div>

			<div *ngIf="user?.date_of_birth">
				<div class="text-xs text-gray-400">Date of Birth</div>
				<div class="mt-1">{{ user?.date_of_birth }}</div>
			</div>
			<div *ngIf="user?.gender">
				<div class="text-xs text-gray-400">Gender</div>
				<div class="mt-1">{{ user?.gender | titlecase }}</div>
			</div>
			<!-- empty cells to keep grid balanced on wider screens -->
			<div class="md:col-span-3"></div>
		</div>
	</div>

	<!-- Address -->
	<div class="bg-white rounded-md shadow-sm p-6">
		<div class="flex items-center justify-between mb-4">
			<h3 class="text-lg font-medium">Address</h3>
		</div>

		<div class="grid grid-cols-1 md:grid-cols-4 gap-6 text-sm text-gray-700">
			<div>
				<div class="text-xs text-gray-400">Country</div>
				<div class="mt-1">Nigeria</div>
			</div>
			<div>
				<div class="text-xs text-gray-400">State</div>
				<div class="mt-1">Lagos</div>
			</div>
			<!-- <div>
				<div class="text-xs text-gray-400">L . G . A</div>
				<div class="mt-1">Amuwo Odofin</div>
			</div> -->
			<div>
				<div class="text-xs text-gray-400">Residential Address</div>
				<div class="mt-1">{{ user?.address }}</div>
			</div>
		</div>

        <!-- Edit Modal -->
    <nz-modal [(nzVisible)]="editModalVisible" nzTitle="Edit Profile" (nzOnCancel)="closeEditModal()" (nzOnOk)="saveProfile()">
      <ng-container *nzModalContent>
        <form nz-form [formGroup]="profileForm" (ngSubmit)="saveProfile()">
          <div class="flex flex-col gap-2 mb-12">
              <label for="full_name" class="text-gray-500 text-xs font-medium">
                Full Name
                <span nz-tooltip nzTooltipTitle="Required field" class="text-red-500">*</span>
              </label>
              <nz-form-control nzErrorTip="Please enter a valid full name">
                <input
                  nz-input
                  id="full_name"
                  formControlName="full_name"
                  placeholder="Enter full name"
                  type="text"
                  class="w-full"
                  [nzSize]="'large'"
                />
              </nz-form-control>
            </div>
            <div class="flex flex-col gap-2 mb-12">
              <label for="phone_number" class="text-gray-500 text-xs font-medium">
                Phone Number
                <span nz-tooltip nzTooltipTitle="Required field" class="text-red-500">*</span>
              </label>
              <nz-form-control nzErrorTip="Please enter a valid phone number">
                <input
                  nz-input
                  id="phone_number"
                  formControlName="phone_number"
                  placeholder="Enter phone number"
                  type="text"
                  class="w-full"
                  [nzSize]="'large'"
                />
              </nz-form-control>
            </div>
            <div class="flex flex-col gap-2 mb-12">
              <label for="gender" class="text-gray-500 text-xs font-medium">
                Gender
                <span nz-tooltip nzTooltipTitle="Required field" class="text-red-500">*</span>
              </label>
              <nz-form-control>
                <nz-select
                  id="gender"
                  formControlName="gender"
                  nzPlaceHolder="Select a gender"
                  class="w-full"
                  [nzSize]="'large'"
                >
                  @for (option of [{value: 'male', label: 'Male'}, {value: 'female', label: 'Female'}, {value: 'other', label: 'Other'}]; track option) {
                    <nz-option [nzValue]="option.value" [nzLabel]="option.label"></nz-option>
                  }
                </nz-select>
              </nz-form-control>
            </div>
            <div class="flex flex-col gap-2 mb-12">
              <label for="date_of_birth" class="text-gray-500 text-xs font-medium">
                Date of Birth
                <span nz-tooltip nzTooltipTitle="Required field" class="text-red-500">*</span>
              </label>
              <nz-form-control>
                <input
                  nz-input
                  id="date_of_birth"
                  formControlName="date_of_birth"
                  placeholder="Select date of birth"
                  type="date"
                  class="w-full"
                  [nzSize]="'large'"
                />
              </nz-form-control>
            </div>
            <div class="flex flex-col gap-2 mb-12">
              <label for="address" class="text-gray-500 text-xs font-medium">
                Address
                <span nz-tooltip nzTooltipTitle="Required field" class="text-red-500">*</span>
              </label>
              <nz-form-control nzErrorTip="Please enter a valid address">
                <input
                  nz-input
                  id="address"
                  formControlName="address"
                  placeholder="Enter address"
                  type="text"
                  class="w-full"
                  [nzSize]="'large'"
                />
              </nz-form-control>
            </div>
            
        </form>
      </ng-container>
        <div *nzModalFooter>
          <button class="!rounded-full !text-gray-500" nz-button nzType="default" (click)="closeEditModal()" [disabled]="isLoading">Cancel</button>
          <button class="!rounded-full !bg-primary !border-none" nz-button nzType="primary" (click)="saveProfile()" [nzLoading]="isLoading" [disabled]="isLoading">Submit</button>
        </div>
    </nz-modal>
	</div>
</div>
